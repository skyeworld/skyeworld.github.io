# BigBrother方案设计v3：公有云最简方案

<p align="right"><font color=Grey>try.chen 2018-11-04</font></p>


BigBrother的转发面设计，按照源目是否含有公有云，主要区分为以下两种：

- **公有云方案：** 一侧为公有云，另一侧不限（公有云/物理云/托管云/跨域等）
- **异构方案：** 两侧都不含公有云，如物理云访问托管云

按照是否含有公有云区分，是因为公有云具有注包和抓包的能力，可以极大简化链路追踪的过程。

## 公有云方案

此前v2中提到的 hook icmp_request和icmp_reply方案有个缺点，**需要在源目分别验证，因此需要发包两次**。对于有一端是异构网络，由于异构网络不支持learn，因此无法反向染色。所以v2中的方案仅限两端都是公有云的情况。

对于公有云方案，还可以优化到只需要发送一个包即可采集全部信息。

<img src="media/15430606723090/15431465182180.jpg" title="" alt="-w693" data-align="center">

## 总结

> 如果不考虑支持异构网络，那这种方案确实是最简单的。

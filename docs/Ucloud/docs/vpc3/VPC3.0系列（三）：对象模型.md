# VPC3.0ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šå¯¹è±¡æ¨¡å‹

<p align="right"><font color=Grey>try.chen 2020-07-02</font></p>

> VPC3.0æœ‰ä¸€å¥—ä¸¥å¯†ã€å¤æ‚çš„å¯¹è±¡æ¨¡å‹å®šä¹‰ï¼Œç†è§£äº†VPC3.0çš„å¯¹è±¡æ¨¡å‹ä¹Ÿå°±ç†è§£äº†VPC3.0æ¨é€çš„æ ¸å¿ƒé€»è¾‘ã€‚

## æ¦‚è¿°

å¯¹äº[VPC3.0ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šæ¨¡å—å’Œåˆ†å±‚](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E6%A8%A1%E5%9D%97%E5%92%8C%E5%88%86%E5%B1%82)ä¸­çš„å¼€å±€åˆ†å±‚æ¶æ„å›¾ï¼Œå…¶å®ä¹Ÿæ˜¯å¯¹è±¡æ¨¡å‹çš„è¾¹ç•Œå›¾ï¼š

![](media/vpc3-brief.png)

å¯ä»¥çœ‹åˆ° 

- å¾®æœåŠ¡å±‚ä¸»è¦è´Ÿè´£ **Model** å¯¹è±¡çš„ç®¡ç†ï¼Œè¿™ä¸ª`Model`å¯¹è±¡æˆ‘ä»¬ç‰¹æŒ‡æ‹¥æœ‰å®Œæ•´å®šä¹‰çš„ä¸šåŠ¡å¯¹è±¡ï¼Œå¦‚`VPC`ã€`Subnet`ã€`Interface`ã€`RouteTable`ã€`ACL`ç­‰ï¼Œå®šä¹‰åœ¨[proto/model](https://git.ucloudadmin.com/vnpd/protos/tree/master/model)ä¸­ï¼Œç”¨äºç³»ç»Ÿé—´è°ƒç”¨ã€`UVPCFE`äº¤äº’ï¼Œå’Œæ•°æ®åº“å­˜å‚¨ç­‰ï¼›

- ä¸­é—´å±‚ä¸»è¦è´Ÿè´£ **Resource** å¯¹è±¡çš„ç®¡ç†ï¼ŒåŒ…æ‹¬æŒä¹…åŒ–ç¼“å­˜ã€è·¯ç”±ã€åˆ†ç‰‡å’Œç°åº¦ç­‰ç­‰ï¼Œç”± `Model` å¯¹è±¡æ ¹æ® `Protobuf Any`åºåˆ—åŒ–åå¾—åˆ°ï¼Œå°†å…·ä½“æŸä¸€ç§`Model`æŠ½è±¡ä¸ºä¸€ä¸ªé€šç”¨çš„`Resource`ï¼Œå®šä¹‰åœ¨[model/resource.proto](https://git.ucloudadmin.com/vnpd/protos/blob/master/model/resource.proto)ä¸­ï¼›

- è½¬å‘å±‚ä¸»è¦è´Ÿè´£ **BridgeObject** å¯¹è±¡çš„ç®¡ç†ï¼Œè¯¥å¯¹è±¡ä¼šç»´æŠ¤è½¬å‘é¢æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œå¦‚`Flow`ã€`Group`ã€`Meter`ç­‰ï¼Œè¯¥å¯¹è±¡æ˜¯ç”± *è½¬å‘é¢ç¿»è¯‘å±‚* å°†`Model`å¯¹è±¡ç¿»è¯‘æˆè½¬å‘é¢æ•°æ®è€Œå¾—åˆ°ï¼Œå› æ­¤å¯¹äºåŒä¸€ä¸ª`Model`æ¯ç§ç¿»è¯‘å±‚ç¿»è¯‘çš„`BridgeObject`å¯èƒ½å¹¶ä¸ç›¸åŒï¼›

> **æ³¨æ„ï¼š** `Model`ã€`Resource`ã€`Object`æè¿°çš„æ˜¯åŒä¸€ä¸ªä¸šåŠ¡å¯¹è±¡åœ¨ä¸åŒå±‚çš„å­˜åœ¨å½¢å¼ä»¥åŠå¯¹è±¡å®šä¹‰ï¼Œæ˜¯å¯ä»¥åŒæ—¶å­˜åœ¨çš„ã€‚å¦‚ `VPC` è¿™ä¸ªä¸šåŠ¡å¯¹è±¡æµç»å¾®æœåŠ¡å±‚æ—¶ï¼Œä¼šå°è£…ä¸º `Model.VPC`ï¼Œè€Œå½“æµç»ä¸­é—´å±‚æ—¶ï¼Œä¼šå°è£…ä¸º `Resource`ï¼Œè€Œæµç»è½¬å‘å±‚ä¼šå°è£…ä¸º`BridgeObject`ã€‚

# 

<img src="media/vpc3-model-tr.png" title="" alt="" data-align="center">

## é€šç”¨å®šä¹‰

ä¸è®ºæ˜¯`Model`ã€`Resource`ã€è¿˜æ˜¯`BridgeObject`ï¼Œéƒ½æœ‰ä¸€ç³»åˆ—é€šç”¨å®šä¹‰å’Œå±æ€§ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸‹è¿™äº›é€šç”¨å±æ€§ã€‚

| å±æ€§      | ç±»å‹     | å«ä¹‰                                                                                                |
| ------- | ------ | ------------------------------------------------------------------------------------------------- |
| id      | uint64 | å¯¹è±¡å”¯ä¸€ç´¢å¼•ï¼Œç›¸åŒå¯¹è±¡è¯¥å­—æ®µå”¯ä¸€ï¼Œç”¨äºæ ‡è¯†å…·ä½“å¯¹è±¡ã€‚æ˜¯å¯¹è±¡å¤„ç†çš„å…³é”®ï¼Œåªåœ¨åç«¯æœ‰æ•ˆã€‚                                                        |
| uuid    | string | å¯¹è±¡å”¯ä¸€å­—ç¬¦ä¸²ç´¢å¼•ï¼Œé™¤`Interface`å¯¹è±¡å¤–ä¸€èˆ¬æ˜¯èµ„æºidï¼Œ`Interface`å¯¹è±¡ä¸ºmacï¼Œå’Œ`id`å­—æ®µä¸€èˆ¬å”¯ä¸€æ˜ å°„ã€‚ä¸€èˆ¬ç”¨äº`Model`å¯¹è±¡åŠå¾®æœåŠ¡å±‚ï¼›              |
| version | uint64 | å¯¹è±¡å¯¹åº”ç‰ˆæœ¬ï¼Œä¸€èˆ¬ä¸ºå…¨å±€å”¯ä¸€ç‰ˆæœ¬ï¼ˆç”±äº‹ä»¶å±‚`Event-Service`åˆ†é…æ‰€å¾—ï¼‰ï¼Œä¿æŒé€’å¢ã€‚å¯¹äºåŒä¸€ä¸ªäº‹ä»¶äº§ç”Ÿçš„`Model`ã€`Resource`ã€`BridgeObject`ç‰ˆæœ¬æ˜¯ç›¸åŒçš„ã€‚ |
| deleted | bool   | æ ‡è®°å¯¹è±¡æ˜¯å¦åˆ é™¤ã€‚                                                                                         |
| account | uint32 | æ ‡è®°å¯¹è±¡å±äºå“ªä¸€ä¸ªaccount(accountIdï¼Œå³é¡¹ç›®Id)ã€‚                                                                |

## Modelå¯¹è±¡

`Model`å¯¹è±¡æ˜¯ä¸šåŠ¡å±‚çš„å¯¹è±¡å®šä¹‰ï¼Œä¸€èˆ¬ç”¨äºå¾®æœåŠ¡ä¹‹é—´çš„äº’ç›¸è°ƒç”¨ï¼Œä»¥åŠå’Œ`UVPCFE`çš„äº¤äº’ï¼Œç”±å¾®æœåŠ¡å±‚çš„æœåŠ¡ç”Ÿæˆã€‚é™¤äº†å«æœ‰ä¸Šè¿°é€šç”¨å­—æ®µå¤–ï¼Œè¿˜å«æœ‰å…·ä½“çš„ä¸šåŠ¡ä¿¡æ¯ï¼Œå¦‚`RouteTable`å¯¹è±¡ä¸­å«æœ‰è·¯ç”±è§„åˆ™ç­‰å±æ€§ï¼Œå¸¸è§`Model`å¯¹è±¡å®šä¹‰å¦‚ä¸‹ï¼š

<!-- tabs:start -->

#### **Interface**

**Protobuf å®šä¹‰**

```protobuf
message Interface {
    uint64 id = 1;                  // ç½‘å¡å¯¹è±¡id, å’Œè½¬å‘é¢cookieå”¯ä¸€å¯¹åº”
    string uuid = 2;                // å¯é€‰ï¼Œå¦‚æœæ˜¯å¼¹æ€§ç½‘å¡ï¼Œåˆ™ä¸ºå¼¹æ€§ç½‘å¡Idï¼Œå¯¹äºéå¼¹æ€§ç½‘å¡ï¼Œæš‚ä¸ºç©º
    string mac = 3;                 // ç½‘å¡mac
    repeated IPv4Address v4 = 4;     // ä¸€ä¸ªç½‘å¡å¯ç»‘å®š0æˆ–å¤šä¸ªIPv4åœ°å€
    repeated IPv6Address v6 = 5;     // ä¸€ä¸ªç½‘å¡å¯ç»‘å®š0æˆ–å¤šä¸ªIPv6åœ°å€
    string objectId = 6;            // ç»‘å®šå¯¹è±¡Id
    ObjectType objectType = 7;      // ç»‘å®šå¯¹è±¡ç±»å‹
    string subnetId = 8;            // ç½‘å¡æ‰€å±SubnetId
    string vpcId = 9;               // ç½‘å¡æ‰€å±VPCId
    uint32 account = 10;            // ç½‘å¡æ‰€å±AccountId
    uint64 dpid = 11;               // ç½‘å¡å¯¹åº”çš„datapathId
    uint32 port = 12;               // ç½‘å¡å¯¹åº”datapath port
    uint64 vni = 13;                // ç½‘å¡æ‰€åœ¨çš„vpcå¯¹åº”çš„vni
    bool gray = 14;                 // æ˜¯å¦ç°åº¦åˆ°vpc3.0
    bool deleted = 15;
    Version version = 20;           // ç½‘å¡å¯¹è±¡Version
    string eventId = 30;            // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
}
```

#### **Subnet**

**Protobuf å®šä¹‰**

```protobuf
message Subnet {
    uint64 id = 1;                      // å­ç½‘å¯¹è±¡Idï¼Œå’Œè½¬å‘é¢cookieå”¯ä¸€å¯¹åº”
    string uuid = 2;                    // å­ç½‘èµ„æºID
    string vpcId = 3;                   // å­ç½‘æ‰€å±VPCId
    uint32 account = 4;                 // å­ç½‘æ‰€å±AccountId
    int32 type = 5;                     // å­ç½‘ç±»å‹ï¼ŒåŒºåˆ†æ˜¯å¦ä¸ºåŸºç¡€å­ç½‘
    string cidrBlockV4 = 6;             // å­ç½‘å…³è”ipv4åœ°å€ç©ºé—´
    string gatewayV4 = 7;               // å­ç½‘å¯¹åº”çš„ipv4ç½‘å…³
    string cidrBlockV6 = 8;             // å­ç½‘å…³è”ipv6åœ°å€ç©ºé—´
    string gatewayV6 = 9;               // å­ç½‘å¯¹åº”ipv6ç½‘å…³
    string routeTableId = 10;           // å­ç½‘å…³è”çš„è·¯ç”±è¡¨Id
    bool deleted = 11;
    Version version = 20;               // å­ç½‘å¯¹è±¡å¯¹åº”ç‰ˆæœ¬
    string eventId = 30;                // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
}
```

#### **VPC**

**Protobuf å®šä¹‰**

```protobuf
message VPC {
    uint64 id = 1;                      // vpcå¯¹è±¡Idï¼Œå’Œè½¬å‘é¢cookieå”¯ä¸€å¯¹åº”
    string uuid = 2;                    // vpcèµ„æºId
    uint32 account = 3;                 // vpcæ‰€å±accountId
    uint32 tunnelId = 4;                // vpcå¯¹åº”çš„éš§é“Idï¼Œç”¨äºoverlayç§Ÿæˆ·ä¿¡æ¯æ ‡è¯†
    repeated string cidrBlocksV4 = 5;   // vpcå¯å…³è”å¤šä¸ªipv4åœ°å€ç©ºé—´
    string cidrBlocksV6 = 6;            // vpcå¯å…³è”ä¸€ä¸ªipv6åœ°å€ç©ºé—´
    int32 type = 7;                     // vpcç±»å‹ï¼Œå…¼å®¹VPC2.0å¯¹è±¡æ¨¡å‹ï¼Œåœ¨VPC2.0ä¸­æ ‡è¯†æ˜¯å¦æ˜¯æ‰˜ç®¡äº‘VPC
    IPv6OperatorName operatorName = 8;
    bool deleted = 9;
    Version version = 20;               // vpcç‰ˆæœ¬
    string eventId = 30;                // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
}
```

#### **VPCæ‰“é€š**

**Protobuf å®šä¹‰**

```protobuf
message VPCShareConnection {
    uint64 id = 1;
    string uuid = 2;
    uint32 account = 3;
    bool deleted = 4;
    string srcVpcUUId = 10;
    uint64 srcVpcId = 11;
    map<uint64, uint32> dstVpcs = 20; // key: vpcId  value: tunnelId
    Version version = 30;
    string eventId = 31;
}
```

#### **RouteTable**

**Protobuf å®šä¹‰**

```protobuf
// è½¬å‘é¢ä½¿ç”¨çš„è·¯ç”±è¡¨å¯¹è±¡ã€‚
// å½“è¯¥è·¯ç”±è¡¨æ˜¯VPCä¸»è·¯ç”±è¡¨æ—¶ï¼Œrulesä¸­ä»…åŒ…å«ä¸»è·¯ç”±è¡¨è§„åˆ™ï¼›å½“è¯¥è·¯ç”±è¡¨æ˜¯è‡ªå®šä¹‰è·¯ç”±è¡¨(å­ç½‘è·¯ç”±è¡¨)æ—¶ï¼Œrulesä¸­åŒ…å«ä¸»è·¯ç”±è¡¨è§„åˆ™+è‡ªå®šä¹‰è·¯ç”±è¡¨è§„åˆ™ã€‚
// å½“è¯¥è·¯ç”±è¡¨æ˜¯Regionè·¯ç”±è¡¨æ—¶ï¼Œè·¯ç”±è§„åˆ™ä»…åŒ…å«regionè·¯ç”±è¡¨è§„åˆ™ã€‚
message BackendRouteTable {
    uint64 id = 1;                                      // è·¯ç”±è¡¨id
    string uuid = 2;                                    // è·¯ç”±è¡¨uuid
    uint32 account = 4;
    bool deleted = 8;
    repeated RouteRule rules = 9;
    Version version = 20;
    string eventId = 21;
}
```

#### **IPv4**

**Protobuf å®šä¹‰**

```protobuf
message PrivateVIP {
    uint64 id = 1;
    string uuid = 2;
    string ip = 3;
    string mac = 4;
    string subnetId = 5;
    string vpcId = 6;
    uint32 account = 7;
    uint64 vni = 8;

    bool deleted = 19;
    Version version = 20;
    string eventId = 30;            // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
}
```

#### **IPv6**

**Protobuf å®šä¹‰**

```protobuf
message IPv6Address {
    string eipID    = 1;
    string ipv6     = 2;
    string subnet   = 3;
    IPv6OperatorName operatorName = 4;
}
```

#### **Datapath**

**Protobuf å®šä¹‰**

```protobuf
message Datapath {
    uint64 id = 1; // datapathå¯¹è±¡idï¼Œä¸è½¬å‘é¢cookieå”¯ä¸€å¯¹åº”ï¼Œä¸ºt_ovs_infoè¡¨ä¸­ä¸»é”®id
    uint64 dpid = 2; // dpid
    repeated string ipv4 = 3;
    repeated string ipv6 = 4;
    repeated OverlayType type = 5;   // éš§é“å°è£…åè®®
}
```

<!-- tabs:end -->

### idå–å€¼

å¯¹äº`Interface`å¯¹è±¡æ¥è¯´ï¼Œ`id`å³ä¸º`mac`çš„æ•´æ•°å½¢å¼ï¼Œè€Œå…¶ä»–å¯¹è±¡`id`ä¸€èˆ¬æ¥æºäºæ•°æ®åº“ä¸»é”®`id`ã€‚å¦‚`VPC`å¯¹è±¡çš„`id`æ¥æºäº`t_vnet_info`ä¸­çš„ä¸»é”®`id`ï¼Œæ‰€ä»¥`id`çš„é•¿åº¦å®šä¹‰ä¸º`48bit`ã€‚

### ç¼“å­˜

`Model`å±‚å¯¹è±¡ä¼šç¼“å­˜åœ¨`Resource-Service`ä¸­ï¼Œå¹¶é€šè¿‡`metadata`è®¾ç½®çš„`use-cache`å­—æ®µæ ‡è¯†æ˜¯å¦æ¥å—ç¼“å­˜ã€‚å¯¹äºéå¼ºä¸€è‡´åœºæ™¯ä¼šé€šè¿‡ç¼“å­˜çš„å¯¹è±¡é™ä½æ•°æ®åº“è´Ÿè½½ï¼Œè€Œç¼“å­˜çš„å¯¹è±¡é€šè¿‡äº‹ä»¶æ›´æ–°ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚

## Resourceå¯¹è±¡

`Resource`å¯¹è±¡æ˜¯åŒ…å«äº†`Model`å¯¹è±¡ã€`BridgeObject`å¯¹è±¡çš„é€šç”¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”±`Resource-Service`çš„clientç”Ÿæˆï¼Œå¦‚`FlowService`ã€`Resource-Builder`ã€‚

ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œ`vpc-123`ä¼šæœ‰`Model`å®šä¹‰`model-vpc-123`ï¼Œä»¥åŠå¯¹åº”çš„è½¬å‘é¢ç¿»è¯‘å¯¹è±¡`BridgeObject`ï¼š`bridgeObject-vpc-123`ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡éœ€è¦è¢«`Resource-Service`æŒä¹…åŒ–å­˜å‚¨ã€è·¯ç”±æ—¶ï¼Œæ— æ³•ç›´æ¥å°†åŸç”Ÿå¯¹è±¡å‘é€ç»™`Resource-Service`å¤„ç†ï¼ˆ`Protobuf`æ˜¯å¼ºç±»å‹å®šä¹‰ï¼‰ï¼Œè€Œéœ€è¦å…ˆwrapæˆ`Resource`å¯¹è±¡å†ç»™`Resource-Service`å¤„ç†ã€‚

`Resource`çš„å®šä¹‰å¦‚ä¸‹ï¼š

```protobuf
message ResourceMetadata {
    string type      = 1;
    string uuid      = 2;
    uint64 id        = 3;
    Version version  = 4;
    bool   deleted   = 5;
    uint32 account   = 6;

    // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
    string eventId   = 10;

    // ç”¨äºè¿½è¸ªå¯¹è±¡çš„spanä¸Šä¸‹æ–‡
    map<string,string> spanContext = 11;
}

message Resource {
    ResourceMetadata    meta      = 1;
    google.protobuf.Any body      = 2;
}
```

å¯ä»¥çœ‹åˆ°`Resource`å¯¹è±¡åŸºæœ¬ç”±ä¹‹å‰æåˆ°çš„é€šç”¨å±æ€§æ„æˆï¼Œè€Œå°†æŸä¸ª`Model`å¯¹è±¡åºåˆ—åŒ–ä¸º`Resource`å¯¹è±¡éœ€è¦ä½¿ç”¨`protobuf`æä¾›çš„`ptypes.MarshalAny`ï¼Œç±»ä¼¼äºå¦‚ä¸‹ä»£ç ï¼š

```go
import "github.com/golang/protobuf/ptypes"

func BuildResource(m *model.VPC) (*model.Resource, error) {
        body, err := ptypes.MarshalAny(m)
        if err != nil {
                return nil, err
        }

        m := &model.ResourceMetadata{
                Type:    body.GetTypeUrl(), // Resource-Serviceä¼šæ ¹æ®è¯¥å­—æ®µåˆ¤æ–­ç±»å‹
                Uuid:    o.GetUuid(),
                Id:      generateId(m),
                Version: o.GetVersion(),
                Deleted: o.GetDeleted(),
                Account: o.GetAccount(),
        }
        r := &model.Resource{
                Meta: m,
                Body: body,
        }
        return r, nil
}
```

å¯ä»¥çœ‹åˆ°åŸºæœ¬æ˜¯å°†`Model`çš„é€šç”¨å±æ€§èµ‹å€¼åˆ°`ResourceMetadata`å­—æ®µï¼Œé™¤äº†æœ‰ä¸€ç‚¹ä¾‹å¤–ï¼š`id`å­—æ®µã€‚

### idå®šä¹‰

æˆ‘ä»¬å‰æ–‡æåˆ°,`bridgeObject-vpc-123`æ˜¯ç”±`model-vpc-123`ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå¯¹è±¡ä¼šæœ‰ç›¸ä¼¼çš„é€šç”¨å±æ€§(idå’Œversion)ï¼Œä¸ºäº†åœ¨`Resource-Service`é‡ŒåŒºåˆ†åŒä¸€ä¸ªä¸šåŠ¡å¯¹è±¡çš„ä¸åŒå±‚è¡ç”Ÿå“ï¼Œéœ€è¦å®šä¹‰ä¸åŒçš„`id`å‰ç¼€ï¼Œå› æ­¤`Resource`çš„`id`å–å€¼æ¥æºäºï¼š

```go
// ä»¥ä¸‹ä»£ç å®šä¹‰åœ¨ vnpd/protos/model/object_helper.goï¼Œå¯ç›´æ¥ä½¿ç”¨

// typ ç”±UniversalResourceType å®šä¹‰, 4bit
// subTyp éštypè€Œå¼‚ï¼Œç›®å‰æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯datapath.BridgeObjectType å’Œ model.ModelObjectType, 12bit
// id æ ‡è¯†å”¯ä¸€å¯¹è±¡ï¼Œ48bit
func GenerateObjectId(typ UniversalResourceType, subTyp int32, id uint64) uint64 {
    return uint64(typ)<<60 | uint64(subTyp)<<48 | id
}
```

å¯ä»¥çœ‹åˆ°`æ–°id`ç”±`UniversalResourceType`ã€`SubType`ã€`åŸå§‹id`ç»„æˆã€‚

#### UniversalResourceType

ä¸€å…±`64bit`çš„`id`å­—æ®µåˆ’åˆ†äº†ä¸‰ä¸ªåŒºåŸŸï¼Œç¬¬ä¸€ä¸ªåŒºåŸŸä¸º`UniversalResourceType`ï¼Œ`4bit`å®½ï¼Œè¿™éƒ¨åˆ†å®šä¹‰å¦‚ä¸‹ï¼š

```protobuf
// 4 bit width
enum UniversalResourceType {
    Reserved = 0;

    // è½¬å‘é¢æ ¹æ®modelå¯¹è±¡ç”Ÿæˆçš„bridgeå¯¹è±¡ï¼ŒåŒ…å«è½¬å‘é¢ä¿¡æ¯å¦‚flowç­‰;
    BridgeObject = 1;

    // modelå¯¹è±¡ï¼Œå¦‚interface/subnet/vpcç­‰èµ„æºå±‚é¢å¯¹è±¡;
    ModelObject = 2;
}
```

ç›®å‰åªæœ‰ä¸Šä¸‹æ¸¸ä¸¤ç§å¯¹è±¡ï¼š`ModelObject`å’Œ`BridgeObject`,åˆ†åˆ«ä»£è¡¨å¾®æœåŠ¡å±‚å¯¹è±¡å’Œè½¬å‘å±‚å¯¹è±¡ã€‚

#### SubType

ç¬¬äºŒä¸ªåŒºåŸŸä¸º`SubType`ï¼Œ`12bit`å®½ï¼Œå«ä¹‰éš`UniversalResourceType`æœ‰ä¸åŒå®šä¹‰ï¼Œç›®å‰å®šä¹‰å¦‚ä¸‹ï¼š

<!-- tabs:start -->

#### **ModelObject**

å½“UniversalResourceTypeå®šä¹‰ä¸ºModelObjectæ—¶ï¼ŒSubTypeå–å€¼å¦‚ä¸‹ï¼š

**Protobuf å®šä¹‰**

```protobuf
// 12 bit width
enum ModelObjectType {
    ObjectInvalid = 0;
    ObjectPipelines = 1;
    ObjectDataPaths = 2;
    ObjectPipelineBinding = 3;

    ObjectInterface = 6;
    ObjectSubNetwork = 7;
    ObjectVPC = 8;
    ObjectPrivateVIP = 9;

    ObjectACL = 12;
    ObjectACLBinding = 13;

    ObjectSecurityGroup = 14;
    ObjectSecurityGroupBinding = 15;

    ObjectVpcShareConnection = 16;
    ObjectSubnetShareConnection = 17;

    ObjectRouteTableBinding = 18;
    ObjectBackendRouteTable = 19;
}
```

#### **BridgeObject**

å½“UniversalResourceTypeå®šä¹‰ä¸ºBridgeObjectæ—¶ï¼ŒSubTypeå–å€¼å¦‚ä¸‹ï¼š

**Protobuf å®šä¹‰**

```protobuf
// 12 bit width
enum BridgeObjectType {
    Invalid = 0;
    Pipelines = 1;
    DataPaths = 2;
    PipelineBinding = 3;
    LocalDatapath = 4;
    LocalInterface = 5;
    Interface = 7;
    SubNetwork = 8;
    VPC = 9;

    RouteTableBinding = 11;

    ACL = 12;
    ACLBinding = 13;

    SecurityGroup = 14;
    SecurityGroupBinding = 15;
    SecurityGroupPipeline = 16;

    // VPCæ‰“é€šã€é¡¹ç›®æ‰“é€šå…³è”å…³ç³»
    VPCShareConnection = 17;
    SubnetShareConnection = 18;

    // deprecated
    RouteTableRegion = 20;
    // deprecated
    RouteTableVpc = 21;
    // deprecated
    RouteTableSubnet = 22;

    BackendRouteTable = 23;

    PrivateVIP = 24;

    // dpagent local
    AsInterface = 100;
    LocalBroadcast = 101;
}
```

<!-- tabs:end -->

`SubType`ç”¨äºæ ‡è¯†å…·ä½“çš„å¯¹è±¡ç±»å‹ä¿¡æ¯ï¼Œä¸è¿‡ä¸­é—´å±‚ã€è½¬å‘å±‚ä¸€èˆ¬ä¸å…³å¿ƒè¿™éƒ¨åˆ†ä¿¡æ¯ï¼ˆå¯¹è±¡æ˜¯å“ªä¸€ç§ï¼‰ã€‚

## BridgeObjectå¯¹è±¡

`BridgeObject`æ˜¯æ‰¿è½½è½¬å‘é¢ä¿¡æ¯çš„å¯¹è±¡ï¼Œ`BridgeObject`ç”±`è½¬å‘é¢ç¿»è¯‘å±‚`çš„æœåŠ¡ç”Ÿæˆï¼Œå…¸å‹æœåŠ¡æœ‰`FlowService`ã€‚ä¸€èˆ¬æ¥è¯´ä¸€ä¸ª`Model`å¯¹è±¡ä¼šæ˜ å°„æˆè‹¥å¹²ä¸ª`BridgeObject`å¯¹è±¡ï¼Œæ˜¯ä¸šåŠ¡å¯¹è±¡åœ¨è½¬å‘é¢çš„æ˜ å°„ã€‚

`BridgeObject`ä¸»è¦å®šä¹‰å¦‚ä¸‹ï¼š

```protobuf
message BridgeObject {
    uint64 id = 1;                  // å‰16ä½ä¸ºBridgeObjectType
    uint64 version = 2;
    BridgeContent content = 3;
    repeated uint64 includes = 4;   // åŒ…å«å…³ç³»ï¼Œç›®å‰ç”¨äºLocalInterfaceåŒ…å«SubNetwork and VPCï¼› BindingåŒ…å«RouteTableã€ACLã€SecurityGroupç­‰
    uint64 owner = 5;               // æ‹¥æœ‰å…³ç³»ï¼Œç›®å‰ç”¨äºInterfaceså’ŒVPCä¹‹é—´å»ºç«‹åŒå‘å…³è”å…³ç³»
    uint64 user = 6;                // ä½¿ç”¨å…³ç³»ï¼Œç›®å‰ç”¨äºBindingå’ŒLocalInterfaceã€SubNetworkä¹‹é—´å»ºç«‹å…³è”å…³ç³»
    repeated uint64 excludes = 7;   // äº’æ–¥å…³ç³»ï¼Œç›®å‰ç”¨äºå…¨å±€PipelineBindingç°åº¦
    string eventId   = 10;          // å¯¹è±¡æœ€æ–°å˜æ›´çš„äº‹ä»¶ID
    map<string,string> spanContext = 11; // ç”¨äºè¿½è¸ªå¯¹è±¡çš„spanä¸Šä¸‹æ–‡
}
```

å…¸å‹çš„idç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼š

```go
func GenerateBridgeObjectInterfaceId(mac string) uint64 {
    m, err := util.MacToUint64(mac)
    if err != nil {
        panic(err)
    }
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_Interface), m)
}

func GenerateBridgeObjectLocalInterfaceId(mac string) uint64 {
    m, err := util.MacToUint64(mac)
    if err != nil {
        panic(err)
    }
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_LocalInterface), m)
}

func GenerateBridgeObjectAsInterfaceId(mac string) uint64 {
    m, err := util.MacToUint64(mac)
    if err != nil {
        panic(err)
    }
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_AsInterface), m)
}

func GenerateBridgeObjectSubnetId(subId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_SubNetwork), subId)
}

func GenerateBridgeObjectVpcId(vpcId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_VPC), vpcId)
}

func GenerateBridgeObjectRouteTableBindingId(subId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_RouteTableBinding), subId)
}

func GenerateBridgeObjectRouteTableId(rtId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_BackendRouteTable), rtId)
}

func GenerateBridgeObjectVipId(vipId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_PrivateVIP), vipId)
}

func GenerateBridgeObjectLocalBroadcast(subId uint64) uint64 {
    return model.GenerateObjectId(model.UniversalResourceType_BridgeObject,
        int32(datapath.BridgeObjectType_LocalBroadcast), subId)
}
```

å…¶ä¸­ï¼Œæœ€å…³é”®çš„å­—æ®µä¸º`includes`ã€`owner`ã€`user`ï¼Œæˆ‘ä»¬å…ˆä»å¯¹è±¡é—´å¼•ç”¨å…³ç³»å¼€å§‹è¯´èµ·ã€‚

## å¯¹è±¡é—´å¼•ç”¨

### ç‰ˆæœ¬çº§è”

> åœ¨è®¾è®¡æ§åˆ¶é¢æ¨é€æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©äº†åŸºäºç«¯åˆ°ç«¯äº‹ä»¶+å…¨å±€ç‰ˆæœ¬å·çš„æ–¹å¼æ¥æ§åˆ¶æ•´ä¸ªæ›´æ–°æµç¨‹ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»å‡ ä¸ªå‰æçº¦æŸï¼š
> 
> - **äº‹ä»¶è§¦å‘**ï¼šè½¬å‘é¢å˜æ›´éƒ½æ˜¯ç”±äº‹ä»¶è§¦å‘çš„ï¼Œæ§åˆ¶é¢åªæœ‰æ”¶åˆ°æŸä¸ªå¯¹è±¡çš„äº‹ä»¶å˜æ›´åï¼Œæ‰ä¼šè¿›è¡Œå¤„ç†ï¼›
> 
> - **ç‰ˆæœ¬ä¿åºå¤„ç†**ï¼šæ¯æ¬¡äº‹ä»¶éƒ½ä¼šé€ æˆè¯¥å¯¹è±¡çš„ç‰ˆæœ¬é€’å¢ï¼Œæ§åˆ¶é¢&è½¬å‘é¢å¢é‡æ›´æ–°æ—¶ï¼Œéƒ½ä¼šæ ¡éªŒè¯¥å¯¹è±¡ç‰ˆæœ¬å·æ˜¯å¦ä¸ºæœ€æ–°ï¼ˆäº‹ä»¶ç‰ˆæœ¬å·å¤§äºæœ¬åœ°ç¼“å­˜å·²å¤„ç†ç‰ˆæœ¬å·ï¼‰ï¼Œåªæœ‰ç‰ˆæœ¬å·æ–°äºè‡ªå·±æ‰ä¼šå¤„ç†ï¼›

äºæ˜¯ï¼Œæˆ‘ä»¬åœ¨æ—©æœŸè®¾è®¡çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¦‚ä¸‹é—®é¢˜ï¼š

!> **ç¤ºä¾‹ä¸€ï¼šè·¯ç”±è¡¨å˜æ›´**

ä¸ºäº†æ¨é€å­ç½‘ç»‘å®šçš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨å­ç½‘å¯¹è±¡çš„structå®šä¹‰ä¸­å¼•å…¥äº†ä¸€ä¸ªå­—æ®µï¼šç»‘å®šçš„è·¯ç”±è¡¨IDï¼Œç”¨äºæè¿°è¯¥å­ç½‘ç»‘å®šäº†å“ªä¸ªè·¯ç”±è¡¨ã€‚**é‚£ä¹ˆå¦‚æœå­ç½‘Aç»‘å®šäº†è·¯ç”±è¡¨B,è·¯ç”±è¡¨Bçš„è§„åˆ™å˜æ›´äº†,ç‰ˆæœ¬å¦‚ä½•å˜æ›´?**

å¯ä»¥æ˜ç¡®çš„æ˜¯è·¯ç”±è¡¨çš„ç‰ˆæœ¬ä¼š++ï¼Œé‚£ä¹ˆå­ç½‘çš„ç‰ˆæœ¬æ˜¯å¦éœ€è¦++å‘¢ï¼Ÿå…¶å®æ˜¯éœ€è¦çš„ï¼Œå¦‚æœå­ç½‘çš„ç‰ˆæœ¬ä¸++ï¼Œå°±æ²¡æ³•è§¦å‘å­ç½‘å¯¹è±¡æ›´æ–°ï¼Œä¹Ÿå°±æ²¡æ³•è§¦å‘å­ç½‘ç»‘å®šçš„è·¯ç”±è¡¨æ›´æ–°ã€‚

!> **ç¤ºä¾‹äºŒï¼šæ–°å»ºäº‘ä¸»æœº**

VPCä¸‹æ–°å»ºäº†ç½‘å¡ï¼ˆäº‘ä¸»æœºï¼‰ï¼Œé‚£ä¹ˆVPCçš„ç‰ˆæœ¬æ˜¯å¦éœ€è¦++ï¼Ÿ

å…¶å®ä¹Ÿæ˜¯éœ€è¦çš„ï¼Œå› ä¸ºå¦‚æœVPCçš„ç‰ˆæœ¬ä¸++ï¼Œä¹Ÿå°±æ²¡æ³•è§¦å‘VPCæ›´æ–°ï¼Œè¿™æ ·å°±æ²¡æ³•æ„ŸçŸ¥VPCä¸‹æœ‰æ–°å»ºå¯¹è±¡ï¼Œæ²¡æ³•æ›´æ–°flowå¹¶æ¨é€ï¼Œå› æ­¤è¯¥VPCä¸‹çš„æ‰€æœ‰interfaceå˜æ›´éƒ½ä¼šå¯¼è‡´VPCçš„ç‰ˆæœ¬é€’å¢ã€‚

!> **ç¤ºä¾‹ä¸‰ï¼šregionè·¯ç”±å˜æ›´**

regionè·¯ç”±è¡¨å˜æ›´äº†ï¼ˆregionè·¯ç”±è¡¨æ˜¯æ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰è·¯ç”±è¡¨çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶è§„åˆ™ä¼šè¢«mergeè¿›ç”¨æˆ·è‡ªå®šä¹‰è·¯ç”±è¡¨ï¼‰ï¼Œé‚£ä¹ˆå…¨ç½‘è·¯ç”±è¡¨çš„ç‰ˆæœ¬æ˜¯å¦è¦++ï¼Ÿç”šè‡³å…¨éƒ¨å­ç½‘ç‰ˆæœ¬æ˜¯å¦è¦++ï¼Ÿå…¶å®ä¹Ÿæ˜¯éœ€è¦çš„ï¼Œè‡ªå®šä¹‰è·¯ç”±è¡¨çš„ç‰ˆæœ¬ä¸é€’å¢å°±æ— æ³•è§¦å‘è·¯ç”±è¡¨çš„å˜æ›´ï¼ŒåŒæ—¶å­ç½‘ç‰ˆæœ¬ä¹Ÿéœ€è¦å˜æ›´ï¼ˆåŒç¤ºä¾‹ä¸€æ‰€è¿°ï¼‰ã€‚

å› æ­¤å¯ä»¥çœ‹åˆ°ï¼Œåº•å±‚çš„ä»»ä½•å¾®å°çš„æ‰°åŠ¨éƒ½ä¼šé€ æˆä¸Šå±‚å¯¹è±¡çš„ç‰ˆæœ¬é€’å¢ï¼Œæœ€ç»ˆå¼•èµ·ä¸€åœºç‰ˆæœ¬å·çš„é£æš´ã€‚ç‰ˆæœ¬å·å˜æ›´ä¸­å¼•å…¥ä¸šåŠ¡é€»è¾‘ï¼ˆåŒ…å«ã€ç»§æ‰¿ç­‰ï¼‰é€ æˆå¯¹è±¡çº§è”ï¼Œè¿™æ˜¯ä¸å¯æ¥å—ã€ä¹Ÿä¸å¯ç»´æŠ¤çš„ï¼Œæœ€ç»ˆä¼šé€ æˆç‰ˆæœ¬çš„â€œğŸ’¥â€ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘ä»¬å¼•å…¥**å¯¹è±¡é—´å¼•ç”¨å…³ç³»**çš„å…³é”®ä¹‹ä¸€ã€‚

### æ‹“æ‰‘å®šä¹‰

æˆ‘ä»¬é¦–å…ˆéœ€è¦å›ç­”ä¸€ä¸ªé—®é¢˜ï¼š

> å½“ä¸€ä¸ªvmåˆšå¼€æœºæ—¶ï¼Œå¯¹åº”è¯¥vmçš„`dpagent`å¦‚ä½•çŸ¥é“æ‹‰å–å“ªäº›å¯¹è±¡å¹¶ä¸‹å‘fowï¼Ÿ

å¯¹äºä¸Šå¸è§†è§’æ¥è¯´åº”è¯¥æ˜¯ï¼š

- æ‰€å±subnetå¯¹åº”çš„`BridgeObject`;

- æ‰€å±vpcå¯¹åº”çš„`BridgeObject`;

- æ‰€å±subnet/vpcå¯¹åº”çš„è·¯ç”±è¡¨çš„`BridgeObject`;

- æ‰€å±vpcä¸‹çš„å…¶ä»–Interfaceå¯¹åº”çš„`BridgeObject`;

- æ‰€å±vpcæ‰“é€šçš„å…¶ä»–vpcä¸Šè¿°ä¿¡æ¯ï¼›

- å…¶ä»–...

åœ¨[æ—©æœŸè®¾è®¡](http://doc.vpc.ucloudadmin.com/#/vpc3/vpc3.0%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1)ä¸­ï¼ŒFlowManageræ‰¿æ‹…äº†æ¨é€çš„å·¥ä½œï¼Œå¯ä»¥åœ¨[å·¥ä½œæµç¨‹](http://doc.vpc.ucloudadmin.com/#/vpc3/vpc3.0%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1?id=%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b-1)ä¸­çœ‹åˆ°æœ‰ä¸¤ä¸ªå…³é”®æ¥å£ï¼š`GetCookieByVPC`å’Œ`GetFlowByCookie`ï¼Œæ§åˆ¶é¢éœ€è¦ä¸ºæ¯ä¸ªVPCå‡†å¤‡å¥½æ‰€æœ‰çš„å¯¹è±¡ç´¢å¼•ï¼ˆCookieï¼ŒåŒæ—¶æœ‰äº›Cookieæ˜¯æ˜ å°„åˆ°å­ç½‘ã€Interfaceç­‰ï¼‰ï¼Œå†ç”±è½¬å‘é¢ï¼ˆAgentï¼‰è‡ªå·±æ¥æ ¹æ®ç´¢å¼•æ‹‰å–å…·ä½“çš„flowã€‚

å› æ­¤å¯¹äºä¸Šè¿°é—®é¢˜ï¼ˆæˆ‘ä»¬ç§°ä¸ºæ‹“æ‰‘è§£æï¼Œå¯»æ‰¾è¿é€šåŸŸå†…çš„æ‰€æœ‰å¯¹è±¡èŠ‚ç‚¹ï¼‰ï¼Œéœ€è¦FlowManageråœ¨æ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå¦‚åˆ›å»ºã€åˆ é™¤äº‘ä¸»æœºï¼Œå˜æ›´è·¯ç”±è¡¨æˆ–ACLç­‰ï¼‰ï¼Œæ›´æ–°å¥½VPCå’ŒCookieçš„æ˜ å°„å…³ç³»å¹¶åŠæ—¶æ¨é€ä¸‹å»ã€‚é‚£ä¹ˆè¿™ä¸ªçŠ¶æ€ä¿¡æ¯çš„ç”Ÿæˆå’Œç»´æŠ¤æ˜¯è¿™ä¸ªé—®é¢˜çš„å…³é”®ï¼Œå¦‚ä½•çµæ´»çš„æ§åˆ¶æ‹“æ‰‘è§£æï¼Œä½¿å¾—å¯¹äºä»¥åæ–°åŠ ä¸€ç§èµ„æºç±»å‹ï¼ˆå¦‚interfaceç»‘å®šå®‰å…¨ç»„ï¼Œinterfaceç»‘å®šFlowLogï¼‰æ—¶å¯ä»¥ä¸ä¿®æ”¹ä»£ç ï¼›å¦‚ä½•é«˜æ•ˆçš„ç”Ÿæˆç´¢å¼•åˆ—è¡¨ï¼Œæ»¡è¶³æ¨é€æ—¶çš„æ€§èƒ½ç­‰æ˜¯è®¾è®¡æ‹“æ‰‘è§£ææ—¶å°±éœ€è¦åº”å¯¹çš„é—®é¢˜ã€‚

åœ¨æ—©æœŸè®¾è®¡æ—¶ï¼Œç´¢å¼•çš„å»ºç«‹æ˜¯éœ€è¦å›ºå®šåœ¨ä»£ç å®ç°ä¸­çš„ï¼ˆå¦‚æ ¹æ®VPCæ‹‰æ‰€æœ‰çš„å­ç½‘ã€ä»¥åŠå­ç½‘ä¸‹çš„Interfaceã€å­ç½‘ç»‘å®šçš„è·¯ç”±è¡¨ã€ACLã€æ‰“é€šçš„VPCåŠå…¶å­åŸŸç­‰ç­‰ï¼‰ï¼Œå› æ­¤æ— æ³•æ»¡è¶³çµæ´»æ§åˆ¶å’Œä¸Šçº¿çš„éœ€æ±‚ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¼•å…¥**å¯¹è±¡é—´å¼•ç”¨å…³ç³»**çš„åŸå› ä¹‹ä¸€ã€‚

æ‰€ä»¥ï¼Œå¦‚ä½•ç»„ç»‡å¯¹è±¡å’Œå¯¹è±¡é—´çš„å…³ç³»ï¼Œå¹¶ä¸”è¯¥å…³ç³»å¦‚ä½•è¢«æ§åˆ¶é¢(dpagent/dpmgr)æ‰€è¯†åˆ«å¹¶è§£æï¼Œæ˜¯é«˜æ•ˆæ¨é€çš„å…³é”®ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰äº†å¦‚ä¸‹çš„å¼•ç”¨æ¨¡å‹ã€‚

### å¼•ç”¨æ¨¡å‹

![](media/model-reference.png)

ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ç§ **â€œå¯¹è±¡â€**ï¼š

| å¯¹è±¡        | å«ä¹‰                                                                          |
| --------- | --------------------------------------------------------------------------- |
| èµ„æºå¯¹è±¡      | å¦‚VPCã€Interfaceã€è·¯ç”±è¡¨ç­‰åŸå­å¯¹è±¡ã€‚                                                    |
| Bindingå¯¹è±¡ | ç»‘å®šå…³ç³»å¯¹è±¡ï¼Œç”¨äºæè¿°å¤šä¸ªèµ„æºå¯¹è±¡ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå¦‚å­ç½‘ç»‘å®šè·¯ç”±è¡¨ï¼Œå­ç½‘ç»‘å®šACLï¼ŒInterfaceç»‘å®šå®‰å…¨ç»„ç­‰ï¼Œé‡ç‚¹åœ¨äºæè¿°â€œ**ç»‘å®šå…³ç³»**â€ã€‚ |

> ä¹‹æ‰€ä»¥å•ç‹¬å®šä¹‰ç»‘å®šå¯¹è±¡ï¼Œæ˜¯ä¸ºäº†è§£è€¦å¯¹è±¡ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œä½¿å¾—ä¸€ç§å¯¹è±¡å˜æ›´ä¸ä¼šå½±å“å…¶è¿æ¥çš„å¯¹ç«¯å¯¹è±¡ï¼Œå½“ç»‘å®šå…³ç³»å˜åŒ–æ—¶ï¼Œåªéœ€è¦å˜æ›´è¿™ä¸ªç»‘å®šå¯¹è±¡æœ¬èº«å³å¯ã€‚ä¸¾ä¸ªä¾‹å­,å¯¹äºæ§åˆ¶é¢æ¥è¯´,å­ç½‘é‡æ–°ç»‘å®šè·¯ç”±è¡¨æ—¶,åªè¦æ¨é€ç»‘å®šå…³ç³»,è€Œæ— éœ€æ¨é€è·¯ç”±è¡¨ã€‚å½“ä¸€ä¸ªç½‘å…ƒä¸Šçš„Nä¸ªå®ä¾‹ç»‘å®šåˆ°äº†åŒä¸€ä¸ªè·¯ç”±è¡¨æ—¶ï¼Œé‚£ä¹ˆè·¯ç”±è¡¨åªéœ€æ¨é€ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯Næ¬¡ï¼Œè€Œåªéœ€è¦æ¨é€Næ¬¡ç»‘å®šå…³ç³»ã€‚

å®šä¹‰å¥½å¯¹è±¡åï¼Œæˆ‘ä»¬å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸‰ç§ **â€œå…³ç³»â€**ï¼š

| å…³ç³»      | å«ä¹‰   | ç¤ºä¾‹                                                                                                                                                                                                                                                                                                    |
| ------- | ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| own     | æ‹¥æœ‰å…³ç³» | vpc own interfaceï¼Œvpcæ‹¥æœ‰å¾ˆå¤šinterfaceï¼Œinterfaceçš„owneræ˜¯vpcã€‚ç”¨äºå…³è”vpcå’Œinterfaceä¹‹é—´çš„å…³ç³»ï¼Œä¹‹æ‰€ä»¥å°†interfaceå’Œvpcå…³è”ï¼Œæ˜¯å› ä¸ºinterfaceçš„é€šä¿¡åŸŸæ˜¯VPCè€Œä¸æ˜¯å­ç½‘ã€‚                                                                                                                                                                          |
| use     | ä½¿ç”¨å…³ç³» | subnet use bindingå¯¹è±¡(å¦‚RouteTableBinding)ï¼Œbindingå¯¹è±¡çš„useræ˜¯subnetã€‚                                                                                                                                                                                                                                       |
| include | å¼•ç”¨å…³ç³» | bindingå¯¹è±¡(å¦‚RouteTableBinding) include å…·ä½“çš„å¯¹è±¡(å¦‚RouteTable)ã€‚                                                                                                                                                                                                                                             |
| exclude | äº’æ–¥å…³ç³» | äº’æ–¥å…³ç³»ç”¨äºåœ¨å¼•ç”¨å…³ç³»ä¸­æ’é™¤æŸäº›å¯¹è±¡ï¼Œå¦‚ï¼šå·²ç»è®¾ä¸ºbroadcastçŠ¶æ€çš„pipelineï¼ˆç»§æ‰¿äº[Globalå¯¹è±¡](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8B%93%E6%89%91%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%A8%E9%80%81?id=global%e5%af%b9%e8%b1%a1)ï¼‰éœ€è¦ç°åº¦æ—¶ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªpipeline bindingå¹¶è®¾ç½®å’Œå‰è¿°å¯¹è±¡çš„äº’æ–¥å…³ç³»ã€‚ |

å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è¿™å¥—æ¨¡å‹æˆ‘ä»¬æ¯”è¾ƒå¥½çš„è§£å†³äº†å‰æ–‡æåˆ°çš„â€œç‰ˆæœ¬çº§è”â€å’Œâ€œæ‹“æ‰‘å®šä¹‰â€çš„é—®é¢˜ã€‚

**ç‰ˆæœ¬çº§è”**

å¯¹äºå‰æ–‡æˆ‘ä»¬æåˆ°çš„ä¸‰ä¸ªé—®é¢˜ï¼š

- **è·¯ç”±è¡¨å˜æ›´ï¼š** å­ç½‘ use è·¯ç”±è¡¨Bindingï¼Œè·¯ç”±è¡¨Binding includeäº†è·¯ç”±è¡¨ï¼Œå› æ­¤åªéœ€è¦è·¯ç”±è¡¨å¯¹è±¡++ï¼Œè€Œæ— éœ€å°†å­ç½‘ç‰ˆæœ¬++ï¼Œå› ä¸ºå­ç½‘å¯¹è±¡å’Œè·¯ç”±è¡¨å¯¹è±¡å·²ç»é€šè¿‡bindingéš”ç¦»äº†ï¼Œå½¼æ­¤æ— éœ€ç›´æ¥æ„ŸçŸ¥ï¼›

- **æ–°å»ºäº‘ä¸»æœºï¼š** VPC own interfaceï¼Œå› æ­¤åªéœ€è¦interfaceçš„ç‰ˆæœ¬++ï¼Œvpcçš„ç‰ˆæœ¬å¹¶ä¸éœ€è¦é€’å¢ï¼Œè¿™æ˜¯å› ä¸ºinterfaceè®¾ç½®äº†è‡ªå·±çš„owneræ˜¯vpcï¼Œå› æ­¤æ§åˆ¶é¢åœ¨è¿›è¡Œæ‹“æ‰‘è§£ææ—¶ï¼ˆåæ–‡ä¼šè§£é‡Šå¦‚ä½•è¿›è¡ŒæŸ¥æ‰¾&è§£æï¼‰ä¼šé€šè¿‡VPCå‘ç°æ–°åˆ›å»ºçš„interfaceï¼Œå³ä½¿VPCçš„ç‰ˆæœ¬å¹¶æ²¡æœ‰é€’å¢ï¼›

- **regionè·¯ç”±è¡¨å˜æ›´ï¼š** å­ç½‘ use è·¯ç”±è¡¨Bindingï¼Œè·¯ç”±è¡¨Binding includeäº†å¤šä¸ªè·¯ç”±è¡¨ï¼Œåˆ†åˆ«æ˜¯regionè·¯ç”±è¡¨ã€å­ç½‘è·¯ç”±è¡¨ã€‚å› æ­¤åªéœ€è¦regionè·¯ç”±è¡¨çš„ç‰ˆæœ¬++å³å¯ï¼Œå­ç½‘è·¯ç”±è¡¨ã€å­ç½‘çš„ç‰ˆæœ¬éƒ½ä¸éœ€è¦é€’å¢ã€‚åŸç†åŒæ ·æ˜¯é€šè¿‡æ‹“æ‰‘è§£æå®Œæˆå˜æ›´çš„æŸ¥æ‰¾ã€‚

å› æ­¤ï¼Œå˜æ›´çš„ç‰ˆæœ¬å›å½’å¯¹è±¡æœ¬èº«ï¼Œæ— ä»»ä½•è¡ç”Ÿçš„ä¸šåŠ¡é€»è¾‘é—®é¢˜ï¼Œé€šè¿‡å¼•ç”¨æ¨¡å‹è§£å†³äº†â€œç‰ˆæœ¬é£æš´â€çš„é—®é¢˜ã€‚

**æ‹“æ‰‘å®šä¹‰**

æ‹“æ‰‘çš„å®šä¹‰ä¸å†ç”±`GetCookieByVPC`è¿™æ ·çš„ä»£ç é€»è¾‘å›ºåŒ–åœ¨æœåŠ¡ä¸­ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è±¡çš„å¼•ç”¨å…³ç³»å®šä¹‰ï¼Œå› æ­¤æ–°åŠ èµ„æºå¯¹è±¡ä»¥åŠå¯¹è±¡ç®€çš„å…³ç³»æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½® use/own/include/excludeå­—æ®µå³å¯å®šä¹‰å‡ºæ‰€éœ€è¦çš„æ‹“æ‰‘ï¼Œæ»¡è¶³çµæ´»æ€§çš„è¦æ±‚ã€‚

## å£°æ˜å¼å¯¹è±¡

>  VPC3.0çš„æ›´æ–°å‚è€ƒäº†K8Sçš„å£°æ˜å¼APIè®¾è®¡ç†å¿µï¼Œæ¯æ¬¡æ›´æ–°éƒ½è‡´åŠ›äºè¾¾åˆ°ç»ˆæ€ï¼Œå› æ­¤åœ¨å¤„ç†ä¸¢å¤±ã€ä¹±åºã€åˆå¹¶ã€é‡è¯•ç­‰å¤æ‚åœºæ™¯æ—¶æä¾›äº†æ›´ä¸ºå¯é çš„æ›´æ–°æœºåˆ¶ã€‚

åœ¨å‰æ–‡ä¸­æˆ‘ä»¬æåˆ°ï¼Œæ§åˆ¶é¢æ¯æ¬¡æ›´æ–°æ—¶ï¼Œéƒ½ä¾èµ–ç‰ˆæœ¬çš„é€’å¢ï¼Œé‚£ä¹ˆå¦‚æœè½¬å‘é¢ï¼ˆå¦‚DPAgentï¼‰åœ¨å¤„ç†Aå¯¹è±¡çš„version=100å˜æ›´æ—¶å¤±è´¥äº†ï¼Œæ­¤æ—¶åç»­Aå¯¹è±¡çš„101ï¼Œ102ï¼Œ103å˜æ›´åˆ°æ¥æ˜¯è¿˜èƒ½ç»§ç»­å¤„ç†å—ï¼Ÿå¦‚æœ100å¤±è´¥äº†ï¼Œæ˜¯å¦ä¼šæ°¸è¿œblock Aå¯¹è±¡çš„åç»­å¤„ç†å‘¢ï¼Ÿ

å¦‚æœ100æ˜¯ä¸€ä¸ªADDï¼Œ101æ˜¯ä¸€ä¸ªDELï¼Œé‚£ä¹ˆéblockçš„è¯æ˜¯å¦å°±å¯¼è‡´äº†ä¸šåŠ¡çš„ä¸å¯é¢„æœŸï¼Ÿ

å¦‚æœé€‰æ‹©ä½¿ç”¨å‘½ä»¤å¼æ›´æ–°çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘ä¸Šè¿°é—®é¢˜ï¼Œå½“æŸä¸ªä¸­é—´ç‰ˆæœ¬æŒç»­å¤±è´¥æ—¶ï¼Œä¼šblockæ‰€æœ‰åç»­å¤„ç†ï¼Œå¹¶ä¸”å¾€å¾€å¯èƒ½éœ€è¦äººä¸ºæ¥å…¥æ‰‹åŠ¨ä¿®å¤æ‰èƒ½æ¢å¤å¤„ç†ï¼ˆå¦‚è„æ•°æ®å½±å“ï¼‰ã€‚

å› æ­¤ï¼ŒVPC3.0æ§åˆ¶é¢åœ¨å¢é‡æ›´æ–°æ—¶ï¼Œå§‹ç»ˆä¼ é€’çš„æ˜¯**æ•´ä¸ªå¯¹è±¡**ï¼Œè€Œéå¯¹è±¡çš„**ä¸€æ¬¡å˜æ›´**ï¼Œè¿™ä¸ªæ˜¯å¯¹è±¡æ›´æ–°æœºåˆ¶ä¸­çš„æ ¸å¿ƒæœºåˆ¶ã€‚é™¤äº†ä¸­é—´ç‰ˆæœ¬å¤±è´¥blocké—®é¢˜ï¼Œå£°æ˜å¼å¯¹è±¡æ›´æ–°è¿˜æœ‰å¦‚ä¸‹å¥½å¤„ï¼š

- å¤©ç„¶å¹‚ç­‰ï¼Œä¾¿äºé‡è¯•ï¼›

- å¤„ç†ä¹±åºã€ç‰ˆæœ¬ä¸¢å¤±æ—¶éƒ½éå¸¸ç®€å•ï¼Œç›´æ¥æ ¹æ®æœ€æ–°ç‰ˆæœ¬æ›´æ–°åˆ°ç»ˆæ€å³å¯ï¼Œä¹±åºä¸”è¿‡æ—¶çš„å¯ä¸åšå¤„ç†ï¼Œç‰ˆæœ¬ä¸¢å¤±ä¹Ÿæ— éœ€å…³å¿ƒï¼›

- å¯¹è±¡æŠ˜å &åˆå¹¶ï¼ŒåŒä¸€å¯¹è±¡è¿ç»­çš„Næ¬¡å˜æ›´åŒæ—¶åˆ°è¾¾æŸä¸ªæœåŠ¡æ—¶ï¼Œè¯¥æœåŠ¡å¯ä»¥ä¸¢å¼ƒä¸­é—´æ‰€æœ‰å¯¹è±¡ï¼Œç›´æ¥é€‰æ‹©æœ€ç»ˆå¯¹è±¡ï¼ˆç‰ˆæœ¬æœ€å¤§ï¼‰ï¼Œé€šè¿‡æŠ˜å &åˆå¹¶ï¼Œé™ä½æ›´æ–°æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½ï¼›

åŒæ—¶ï¼Œå£°æ˜å¼æ›´æ–°ä¹Ÿéš¾ä»¥é¿å…ä¸€ä¸ªé—®é¢˜ï¼šæ›´æ–°æ—¶çš„æ€§èƒ½é—®é¢˜ã€‚ç”±äºæ¯æ¬¡RPCéƒ½éœ€è¦ä¼ é€’æ•´ä¸ªå¯¹è±¡ï¼Œå¯¹äºæŸäº›å¤§å¯¹è±¡ï¼ˆå¦‚è·¯ç”±è¡¨ï¼‰å¯èƒ½ä¼šæµªè´¹é¢å¤–çš„ç½‘ç»œIOã€åºåˆ—åŒ–ååºåˆ—åŒ–è€—æ—¶ã€è½¬å‘é¢ï¼ˆOVSï¼‰åŸå­æ›´æ–°è€—æ—¶ç­‰ã€‚

## ç‰ˆæœ¬å·æœºåˆ¶

å¦‚å‰æ–‡protoä¸­å®šä¹‰ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡çš„structå®šä¹‰ä¸­éƒ½æºå¸¦æœ‰ç‰ˆæœ¬å·ï¼Œè€Œè¯¥ç‰ˆæœ¬å·åœ¨æ•°æ®å˜åŒ–æºå¤´å°±ä¼šè¢«å¸¦ä¸Šï¼Œå¹¶éšç€å¯¹è±¡åœ¨ç³»ç»Ÿä¸­çš„æµåŠ¨è´¯ç©¿å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå…³äºç‰ˆæœ¬å·åæ–‡ä¼šè¯¦ç»†ä»‹ç»ã€‚

## BridgeObjectå¯¹è±¡å¼•ç”¨å…³ç³»

<!-- tabs:start -->

#### **Interface**

Interfaceå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»    | å€¼     | å«ä¹‰                            |
| ----- | ----- | ----------------------------- |
| owner | vpcId | interfaceæ‰€å±vpcçš„vpc id(uint64) |

> **è§£é‡Šï¼š**  Interfaceå¯¹è±¡ä¼šå°†ownerè®¾ç½®ä¸ºvpcï¼Œä¾¿äºæ ¹æ®VPCå¯»æ‰¾åˆ°å…¶ä¸‹æ‰€æœ‰çš„Interfaceå¯¹è±¡ã€‚

#### **Local Interface**

Local Interfaceå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»      | å€¼               | å«ä¹‰                                                |
| ------- | --------------- | ------------------------------------------------- |
| include | subnetId, vpcId | interfaceå¯¹è±¡çš„æ‰€å±çš„subnet id(uint64) å’Œ vpc id(uint64) |

> **è§£é‡Šï¼š**  Local Interfaceå¯¹è±¡ä¼šå°†includeè®¾ç½®ä¸ºæ‰€å±çš„subnetIdå’ŒvpcIdã€‚

#### **IPv6**

IPv6å¯¹è±¡æºå¸¦äº†IPv6ç›¸å…³çš„flowï¼Œå¹¶ä¸”ç”±äºovså¯¹äºIPv6 Flowçš„æ”¯æŒé™åˆ¶ï¼ˆä¸»è¦æ˜¯userdataå­—æ®µï¼‰ï¼ŒIPv6å¯¹è±¡è®¾ç½®äº†[OVSç‰ˆæœ¬äº²å’Œæ€§](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8B%93%E6%89%91%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%A8%E9%80%81?id=ovs%e7%89%88%e6%9c%ac%e4%ba%b2%e5%92%8c%e6%80%a7)ï¼Œå¯¹äºIPv6åªæœ‰OVS 2.6åŠä»¥åçš„ç‰ˆæœ¬æ‰ä¼šæ¨é€è¯¥å¯¹è±¡ã€‚

IPv6å¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»    | å€¼           | å«ä¹‰                      |
| ----- | ----------- | ----------------------- |
| owner | interfaceId | è¯¥IPv6å¯¹è±¡å¯¹åº”çš„Interfaceå¯¹è±¡Id |

#### **Subnet**

Subnetå¯¹è±¡ä¸ä¼šè®¾ç½®ownerã€userã€includeã€‚

#### **VPC**

VPCå¯¹è±¡ä¸ä¼šè®¾ç½®ownerã€userã€includeã€‚

#### **RouteTableBinding**

**è·¯ç”±è¡¨å¯¹è±¡è®¾è®¡**

æˆ‘ä»¬æŠŠè·¯ç”±è¡¨ç»‘å®šè®¾è®¡åœ¨å­ç½‘ä¸Šï¼Œè¿™æ˜¯å› ä¸ºè·¯ç”±è¡¨æ˜¯å¯ä»¥å…³è”åˆ°å­ç½‘çº§åˆ«çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨includeä¸­åŒ…å«çš„è·¯ç”±è¡¨å…¶å®æ˜¯æœ€ç»ˆç”Ÿæ•ˆçš„å­ç½‘è·¯ç”±è¡¨ï¼Œå…¶ä¸­çš„è·¯ç”±è§„åˆ™åŒ…å«VPCä¸»è·¯ç”±è¡¨ä¸­çš„è·¯ç”±è§„åˆ™ï¼ŒåŒæ—¶ä¹ŸåŒ…å«å­ç½‘è·¯ç”±è¡¨æœ¬èº«çš„è·¯ç”±è§„åˆ™ï¼›è€Œregioné»˜è®¤è·¯ç”±è¡¨çš„è§„åˆ™æˆ‘ä»¬æ˜¯åµŒåœ¨å­ç½‘è·¯ç”±è¡¨å¯¹è±¡çš„includeå­—æ®µä¸­çš„ã€‚

æˆ‘ä»¬ä¹‹æ‰€ä»¥æŠŠregionè·¯ç”±è¡¨çš„è·¯ç”±è§„åˆ™å’Œå­ç½‘è·¯ç”±è¡¨çš„è§„åˆ™éš”ç¦»å¼€æ¥ï¼Œæ˜¯å› ä¸ºä»¥ä¸‹ä¸¤ç‚¹ï¼š

- åŒä¸€å°å®¿ä¸»æœºä¸Šçš„regioné»˜è®¤è·¯ç”±è¡¨flowå¯ä»¥å…±äº«å’Œå¤ç”¨ï¼Œè€Œä¸éœ€è¦æ¯ä¸ªvméƒ½æ¨é€ä¸€éï¼›
- regioné»˜è®¤è·¯ç”±è¡¨å˜æ›´æ—¶ï¼Œåªéœ€è¦æ¨é€é»˜è®¤è·¯ç”±è¡¨å³å¯ï¼Œè€Œæ— éœ€å…¨ç½‘å­ç½‘è·¯ç”±è¡¨éƒ½æ¨é€ä¸€éï¼›

---

RouteTableå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»      | å€¼            | å«ä¹‰                        |
| ------- | ------------ | ------------------------- |
| user    | subnetId     | å…³è”è¯¥bindingå¯¹è±¡çš„å­ç½‘           |
| include | routeTableId | è¯¥bindingå¯¹è±¡å¯¹åº”çš„è·¯ç”±è¡¨Idï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ª |

#### **RouteTable**

åœ¨è¿™é‡Œå¤šè¯´ä¸€ç‚¹RouteTableå¯¹è±¡çš„è®¾è®¡ï¼Œå¯¹äºè·¯ç”±è¡¨ä¸­çš„è·¯ç”±è§„åˆ™æœ‰ä»¥ä¸‹å‡ ç§ç‰¹æ®Šæƒ…å†µï¼š

- instanceè·¯ç”±ï¼šå¯¹äºinstanceè·¯ç”±ï¼ŒnexthopIdä¼šè®¾ç½®ä¸ºinstanceæ‰€å¯¹åº”çš„ipï¼›è¯¥instanceå¦‚æœå‘ç”Ÿè¿ç§»ï¼Œé‚£ä¹ˆè·¯ç”±è¡¨æ˜¯ä¸éœ€è¦å˜åŒ–çš„ï¼Œå› ä¸ºè½¬å‘é¢ä¼šå…ˆæ‰¾åˆ°instanceè·¯ç”±ï¼Œè€Œåæ ¹æ®è·¯ç”±ä¸­è®¾ç½®çš„ipå»æ‰¾å®é™…çš„macå’Œä½ç½®å…³ç³»ï¼Œè€Œè¿™ä¸ªä½ç½®å…³ç³»æ˜¯ç”±Interfaceå¯¹è±¡æ¥ç¡®å®šçš„ï¼›
- vipè·¯ç”±ï¼šå¯¹äºvipè·¯ç”±ï¼ŒnexthopIdä¼šè®¾ç½®ä¸ºvipæ‰€åœ¨çš„å½“å‰vipï¼›åœ¨è¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šç–‘é—®ï¼Œvipæ¼‚ç§»æ—¶ï¼Œvipè·¯ç”±æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿéœ€è¦æ›´æ–°è·¯ç”±è¡¨å¯¹è±¡å—ï¼Ÿå®é™…æ˜¯ä¸éœ€è¦çš„ã€‚vipæ¼‚ç§»æ—¶ï¼ŒPrivateVipå¯¹è±¡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè½¬å‘é¢ä¼šå…ˆåŒ¹é…vipè·¯ç”±ï¼Œè€Œåä¼šå»æ ¹æ®PrivateVipå¯¹è±¡ç”Ÿæˆçš„vipå’Œmacçš„å¯¹åº”å…³ç³»å»æŸ¥è¯¢å®é™…vmã€‚

å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬ä¹Ÿæ˜¯å¾ˆå¤æ‚çš„åµŒå¥—ã€çº§è”å…³ç³»ï¼Œé€šè¿‡å¼•ç”¨æ¨¡å‹çš„è§£è€¦å˜å¾—éå¸¸ç®€å•ã€‚

è€Œè·¯ç”±è¡¨å¯¹è±¡çš„includeä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæƒ…å†µï¼š

- å¦‚æœè·¯ç”±è¡¨æ˜¯regioné»˜è®¤è·¯ç”±è¡¨ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¾€å¾€æ˜¯ç©ºçš„ï¼›
- å¦‚æœè·¯ç”±è¡¨æ˜¯å­ç½‘è·¯ç”±è¡¨ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¾€å¾€ä¼šåŒ…å«regioné»˜è®¤è·¯ç”±è¡¨çš„Idï¼›
- å¦‚æœè·¯ç”±è¡¨æ˜¯å­ç½‘è·¯ç”±è¡¨ï¼Œä¸”åŒ…å«äº†VPCæ‰“é€šçš„è·¯ç”±ï¼Œé‚£ä¹ˆè¯¥å­—æ®µé™¤äº†åŒ…å«regioné»˜è®¤è·¯ç”±è¡¨ä¹‹å¤–ï¼Œè¿˜ä¼šåŒ…å«æ‰“é€šçš„VPCçš„Idï¼›

å¯ä»¥å‚è€ƒå½“æ—¶çš„éƒ¨åˆ†è®¨è®ºè®°å½•ï¼š[è®¨è®ºçºªè¦](https://ushare.ucloudadmin.com/pages/viewpage.action?pageId=28390905)

---

RouteTableå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»      | å€¼                     | å«ä¹‰                    |
| ------- | --------------------- | --------------------- |
| include | routeTableId, vpcId ç­‰ | è·¯ç”±è¡¨å¯¹è±¡å¯ä»¥å¼•ç”¨å…¶ä»–è·¯ç”±è¡¨ï¼Œæˆ–è€…ç›¸å…³å¯¹è±¡ |

#### **VPCShareConnection**

VPCæ‰“é€š(å«é¡¹ç›®æ‰“é€š)å¯¹åº”çš„å¯¹è±¡æˆ‘ä»¬ç§°ä¸ºVPCShareConnectionï¼Œæˆ‘ä»¬ä¼šä¸ºæœ‰æ‰“é€šå…³ç³»çš„æ¯ä¸ªvpcåˆ›å»ºä¸€ä¸ªVPCShareConnectionå¯¹è±¡ã€‚

è¯¥å¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»      | å€¼        | å«ä¹‰                 |
| ------- | -------- | ------------------ |
| owner   | vpcId    | è¯¥æ‰“é€šå…³ç³»æ‰€å¯¹åº”çš„vpcçš„vpcId |
| include | vpcId... | æ‰“é€šçš„æ‰€æœ‰å¯¹ç«¯vpcçš„vpcId   |

#### **PrivateVip**

ä¸ºäº†ä½¿å¾—å†…ç½‘é«˜å¯ç”¨VIPçš„æ¼‚ç§»æ˜¯æ— çŠ¶æ€çš„ï¼Œæˆ‘ä»¬ä¹Ÿå®šä¹‰äº†PrivateVipå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”¨æ¥è¡¨ç¤ºVipå’Œå®é™…macçš„å¯¹åº”å…³ç³»ã€‚

è¯¥å¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š

| å…³ç³»    | å€¼     | å«ä¹‰               |
| ----- | ----- | ---------------- |
| owner | vpcId | è¯¥VIPæ‰€å±çš„vpcçš„vpcId |

#### **Pipeline**

Pipelineå¯¹è±¡æ²¡æœ‰è®¾ç½®å¼•ç”¨å…³ç³»ã€‚

#### **PipelineBinding**

PipelineBindingå¯¹è±¡ç”¨äºå…³è”pipelineå’Œå…·ä½“çš„è½¬å‘é¢ç½‘å…ƒï¼Œè®¾è®¡è¯¥å¯¹è±¡çš„åˆè¡·æ˜¯ä¸ºäº†å¯ä»¥æ”¯æŒpipelineçš„ç°åº¦å’ŒæŒ‡å®šä¸‹å‘éƒ¨åˆ†ç½‘å…ƒã€‚

å¯¹äºè½¬å‘é¢ç½‘å…ƒï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ç§scopeï¼š

- vswitchçº§åˆ«ï¼šæ¯å°vswitch(dpagent)æ³¨å†Œåˆ°dpmgrä¹‹åï¼Œdpmgrä¼šäº§ç”Ÿä¸€ä¸ªvswitchå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„idå€¼ç­‰äºdpidã€‚å½“bindingçš„userè®¾ç½®ä¸ºè¯¥å€¼åï¼Œæ ‡è¯†åªå…³è”åˆ°æŒ‡å®šçš„vswitchä¸Šï¼Œä¹Ÿå³æŸå°æŒ‡å®šå®¿ä¸»æœºï¼Œå…·ä½“è¯·å‚è€ƒ[vswitchå¯¹è±¡](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8B%93%E6%89%91%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%A8%E9%80%81?id=vswitch%e5%af%b9%e8%b1%a1)ï¼›
- globalçº§åˆ«ï¼šè¯¥globalæŒ‡çš„æ˜¯æŸä¸ªregionï¼Œå¯¹è±¡çš„idå€¼ç­‰äºregionIdã€‚å½“bindingçš„userè®¾ç½®ä¸ºè¯¥å€¼åï¼Œæ ‡è¯†pipelineä¼šæ¨é€åˆ°æ•´ä¸ªregionæ‰€æœ‰çš„vswitchä¸Šï¼Œä¹Ÿå³regionå†…çš„å…¨éƒ¨å®¿ä¸»æœºä¸Šï¼Œå…·ä½“è¯·å‚è€ƒ[Globalå¯¹è±¡](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8B%93%E6%89%91%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%A8%E9%80%81?id=global%e5%af%b9%e8%b1%a1)ï¼›

---

| å…³ç³»      | å€¼             | å«ä¹‰                                                                                                                                                                                                                                                                                                                                      |
| ------- | ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| user    | scopeId       | scopeIdä¸»è¦æœ‰ä¸¤ç§ï¼švswitch dpidæˆ–è€…regionId                                                                                                                                                                                                                                                                                                     |
| include | pipelineId... | å¼•ç”¨çš„æ‰€æœ‰å…³è”pipelineId                                                                                                                                                                                                                                                                                                                       |
| exclude | pipelineId... | å¸¸ç”¨äºbroadcastçŠ¶æ€çš„pipelineç°åº¦ï¼Œå¦‚ï¼šå·²ç»è®¾ä¸ºbroadcastçŠ¶æ€çš„pipeline Aï¼ˆç»§æ‰¿äº[Globalå¯¹è±¡](http://doc.vpc.ucloudadmin.com/#/vpc3/VPC3.0%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8B%93%E6%89%91%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%A8%E9%80%81?id=global%e5%af%b9%e8%b1%a1)ï¼‰éœ€è¦ç°åº¦æ—¶ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªpipeline binding å¼•ç”¨ç°åº¦å¯¹è±¡Bå¹¶è®¾ç½®å’ŒAçš„äº’æ–¥å…³ç³»ï¼Œæ­¤æ—¶å°†å”¯ä¸€æ¨é€Bå¯¹è±¡ï¼Œè€Œä¸ä¼šæ¨é€Aå¯¹è±¡ã€‚ |

#### **Firewall**

Firewallå¯¹è±¡æ²¡æœ‰è®¾ç½®å¼•ç”¨å…³ç³»ã€‚

#### **FirewallBinding**

| å…³ç³»      | å€¼             | å«ä¹‰                      |
| ------- | ------------- | ----------------------- |
| owner   | interfaceId   | è¯¥bindingæ‰€å±çš„interface id |
| include | firewallId... | å…³è”çš„firewall Id          |

<!-- tabs:end -->
